import{j as e,r as d,c as N,R as S}from"./client.js";const A=({onSettingsClick:t})=>e.jsxs("div",{className:"header",children:[e.jsx("h1",{children:"Anna AI Shopping Assistant"}),e.jsx("button",{className:"settings-button",onClick:t,children:"Settings"})]}),E=({text:t,type:s,timestamp:o})=>{const r=c=>{if(!c)return"";const h=c.replace(/\[([^\]]+)\]\(([^)]+)\)/g,(y,p,f)=>`<a href="${f}" target="_blank" rel="noopener noreferrer" class="message-link">${p}</a>`);return e.jsx("span",{dangerouslySetInnerHTML:{__html:h}})},u=c=>c?new Date(c).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"";return e.jsxs("div",{className:`message ${s}`,children:[e.jsx("div",{className:"message-content",children:r(t)}),e.jsx("div",{className:"message-timestamp",children:u(o)})]})},R=({products:t})=>(console.log("ProductResults received products:",t),!t||t.length===0?(console.log("No products to display"),null):e.jsx("div",{className:"product-results",children:t.map((s,o)=>(console.log("Rendering product:",s),e.jsxs("a",{className:"product-card",href:s.url,target:"_blank",rel:"noopener noreferrer",children:[e.jsx("img",{src:s.image,alt:s.title,className:"product-image",onError:r=>{console.log("Image load error for:",s.title),r.target.src="https://via.placeholder.com/100x100?text=No+Image"}}),e.jsxs("div",{className:"product-info",children:[e.jsx("h3",{className:"product-title",children:s.title}),e.jsx("div",{className:"product-price",children:s.price}),s.rating&&e.jsxs("div",{className:"product-rating",children:[e.jsx("span",{className:"stars",children:"â˜…".repeat(Math.round(s.rating))}),e.jsxs("span",{className:"rating-text",children:[s.rating.toFixed(1)," (",s.reviewCount.toLocaleString()," reviews)"]})]}),s.isPrime&&e.jsx("div",{className:"prime-badge",children:"Prime"})]})]},s.asin||o)))})),k=()=>e.jsxs("div",{className:"typing-indicator",children:[e.jsx("div",{className:"dot"}),e.jsx("div",{className:"dot"}),e.jsx("div",{className:"dot"})]}),C=({messages:t,isTyping:s})=>{const o=d.useRef(null);return d.useEffect(()=>{o.current&&(o.current.scrollTop=o.current.scrollHeight)},[t,s]),d.useEffect(()=>{console.log("Messages updated:",t)},[t]),e.jsxs("div",{className:"chat-container",ref:o,children:[t.map((r,u)=>(console.log("Rendering message:",r),e.jsxs("div",{children:[e.jsx(E,{text:r.text,type:r.type,timestamp:r.timestamp}),r.products&&e.jsxs("div",{children:[console.log("Rendering products:",r.products),e.jsx(R,{products:r.products})]})]},u))),s&&e.jsx(k,{})]})},I=({onSendMessage:t,disabled:s})=>{const[o,r]=d.useState(""),u=c=>{c.preventDefault(),o.trim()&&(t(o),r(""))};return e.jsxs("form",{className:"input-container",onSubmit:u,children:[e.jsx("input",{type:"text",value:o,onChange:c=>r(c.target.value),placeholder:"Ask me about products...",disabled:s}),e.jsx("button",{type:"submit",disabled:s||!o.trim(),children:"Send"})]})};function M(){const[t,s]=d.useState([]),[o,r]=d.useState(!1),[u,c]=d.useState(!1);d.useEffect(()=>{h(),y(),(async()=>{try{const{lastSearchResults:i}=await chrome.storage.local.get("lastSearchResults");if(i){console.log("Found stored search results:",i);const l={type:"assistant",text:"Here are the products from your last search:",products:i.products,timestamp:Date.now()};s(a=>[...a,l]),await chrome.storage.local.remove("lastSearchResults")}}catch(i){console.error("Error checking stored results:",i)}})()},[]),d.useEffect(()=>{t.length>0&&p(t)},[t]);const h=async()=>{try{const n=await chrome.runtime.sendMessage({action:"checkApiConfig"});c(n.openaiConfigured),n.openaiConfigured||s([{type:"system",text:"Please configure your OpenAI API key in the settings to start using Anna AI.",timestamp:Date.now()}])}catch(n){console.error("Error checking API configuration:",n)}},y=async()=>{try{const n=await chrome.storage.local.get("chatHistory");n.chatHistory&&s(n.chatHistory)}catch(n){console.error("Error loading chat history:",n)}},p=async n=>{try{await chrome.storage.local.set({chatHistory:n})}catch(i){console.error("Error saving chat history:",i)}},f=()=>{chrome.runtime.openOptionsPage()},j=async n=>{if(!u){s(l=>[...l,{type:"system",text:"Please configure your OpenAI API key in the settings first.",timestamp:Date.now()}]);return}const i={type:"user",text:n,timestamp:Date.now()};s(l=>[...l,i]),r(!0);try{console.log("Sending search request:",n);const a=await new Promise((m,g)=>{const v=setTimeout(()=>{g(new Error("Request timed out"))},3e4);chrome.runtime.sendMessage({action:"searchProducts",query:n},w=>{clearTimeout(v),chrome.runtime.lastError?g(new Error(chrome.runtime.lastError.message)):m(w)})});if(console.log("Received response:",a),a.error)throw new Error(a.error);if(!a.products||!Array.isArray(a.products)||a.products.length===0)throw new Error("No products found. Please try a different search.");console.log("Adding assistant message with products:",a.products);const x={type:"assistant",text:"Here are some products that match your request:",products:a.products,timestamp:Date.now()};if(s(m=>[...m,x]),a.searchUrl){const m={type:"assistant",text:`Would you like to see more results? [View all results on Amazon](${a.searchUrl})`,timestamp:Date.now()};s(g=>[...g,m])}}catch(l){console.error("Search error:",l);const a={type:"error",text:`Error: ${l.message}`,timestamp:Date.now()};s(x=>[...x,a])}finally{r(!1)}};return e.jsxs("div",{className:"app",children:[e.jsx(A,{onSettingsClick:f}),e.jsx(C,{messages:t,isTyping:o}),e.jsx(I,{onSendMessage:j,disabled:!u||o})]})}const P=document.getElementById("root"),b=N.createRoot(P);b.render(e.jsx(S.StrictMode,{children:e.jsx(M,{})}));
